# Entity-Relationship Diagram

This ER diagram represents the database schema for the Medical Portal System.

```mermaid
erDiagram
    USER ||--o{ MEDICAL_REPORT : "has"
    USER ||--o{ SESSION : "has"
    USER ||--o{ NOTIFICATION : "receives"
    MEDICAL_REPORT ||--|| AI_ANALYSIS : "contains"
    MEDICAL_REPORT ||--o{ REPORT_IMAGE : "includes"
    MEDICAL_REPORT ||--o{ DOCTOR_REVIEW : "reviewed_by"
    AI_MODEL ||--o{ AI_ANALYSIS : "generates"
    AI_MODEL ||--o{ MODEL_METRICS : "tracked_by"
    
    USER {
        string id PK
        string name
        string email UK
        string password_hash
        enum role "patient, radiologist, doctor, tech"
        string profile_picture_url
        datetime created_at
        datetime updated_at
        boolean is_active
        json preferences
    }
    
    SESSION {
        string session_id PK
        string user_id FK
        datetime login_time
        datetime last_activity
        string ip_address
        string user_agent
        boolean is_active
    }
    
    MEDICAL_REPORT {
        string report_id PK
        string patient_id FK
        string radiologist_id FK
        string report_image_url
        enum risk_score "low, medium, high"
        float confidence_score
        datetime upload_date
        datetime analysis_date
        string status "pending, analyzed, reviewed"
        json metadata
    }
    
    REPORT_IMAGE {
        string image_id PK
        string report_id FK
        string image_url
        string image_type "xray, ct_scan, mri"
        int width
        int height
        int file_size
        datetime uploaded_at
    }
    
    AI_ANALYSIS {
        string analysis_id PK
        string report_id FK
        string model_id FK
        enum risk_category "low, medium, high"
        float risk_probability
        json findings
        json feature_maps
        datetime processed_at
        int processing_time_ms
    }
    
    AI_MODEL {
        string model_id PK
        string model_name
        string version
        string architecture "CNN, ResNet, EfficientNet"
        datetime trained_date
        datetime deployed_date
        boolean is_active
        json model_config
    }
    
    MODEL_METRICS {
        string metric_id PK
        string model_id FK
        float accuracy
        float precision
        float recall
        float f1_score
        int total_predictions
        int correct_predictions
        datetime recorded_at
        string dataset_version
    }
    
    DOCTOR_REVIEW {
        string review_id PK
        string report_id FK
        string doctor_id FK
        string review_notes
        enum urgency_level "routine, follow_up, urgent"
        boolean confirmed_ai_diagnosis
        datetime reviewed_at
        string recommended_action
    }
    
    NOTIFICATION {
        string notification_id PK
        string user_id FK
        string type "new_report, urgent_case, system_alert"
        string title
        string message
        boolean is_read
        datetime created_at
        datetime read_at
        json metadata
    }
```

## Entity Descriptions

### USER
- **Primary Key**: `id`
- **Purpose**: Stores all system users (patients, radiologists, doctors, tech team)
- **Relationships**: 
  - Has many medical reports (for patients)
  - Has many sessions
  - Receives many notifications

### MEDICAL_REPORT
- **Primary Key**: `report_id`
- **Purpose**: Central entity for X-ray reports and AI analysis results
- **Relationships**:
  - Belongs to one patient (user)
  - Uploaded by one radiologist (user)
  - Contains one AI analysis
  - May have multiple report images
  - Can be reviewed by multiple doctors

### AI_ANALYSIS
- **Primary Key**: `analysis_id`
- **Purpose**: Stores AI model predictions and risk assessments
- **Relationships**:
  - Belongs to one medical report
  - Generated by one AI model
  - Contains JSON findings with detailed analysis

### AI_MODEL
- **Primary Key**: `model_id`
- **Purpose**: Tracks different AI model versions and configurations
- **Relationships**:
  - Generates many AI analyses
  - Has many model metrics for performance tracking

### MODEL_METRICS
- **Primary Key**: `metric_id`
- **Purpose**: Tracks AI model performance over time
- **Relationships**:
  - Belongs to one AI model
  - Recorded at regular intervals for monitoring

### DOCTOR_REVIEW
- **Primary Key**: `review_id`
- **Purpose**: Stores doctor's clinical review of AI-analyzed reports
- **Relationships**:
  - Belongs to one medical report
  - Created by one doctor (user)

### NOTIFICATION
- **Primary Key**: `notification_id`
- **Purpose**: Manages system notifications for users
- **Relationships**:
  - Belongs to one user
  - Types: new reports, urgent cases, system alerts

### SESSION
- **Primary Key**: `session_id`
- **Purpose**: Manages user authentication sessions
- **Relationships**:
  - Belongs to one user
  - Tracks login activity and security

## Key Indexes

```sql
-- Performance optimization indexes
CREATE INDEX idx_report_patient ON MEDICAL_REPORT(patient_id);
CREATE INDEX idx_report_status ON MEDICAL_REPORT(status);
CREATE INDEX idx_report_risk ON MEDICAL_REPORT(risk_score);
CREATE INDEX idx_report_date ON MEDICAL_REPORT(upload_date DESC);
CREATE INDEX idx_analysis_model ON AI_ANALYSIS(model_id);
CREATE INDEX idx_notification_user ON NOTIFICATION(user_id, is_read);
CREATE INDEX idx_session_active ON SESSION(user_id, is_active);
```

## Data Constraints

- **Email**: Must be unique across all users
- **Risk Scores**: Enum values must be one of: 'low', 'medium', 'high'
- **User Roles**: Enum values must be one of: 'patient', 'radiologist', 'doctor', 'tech'
- **Confidence Score**: Float between 0.0 and 1.0
- **Risk Probability**: Float between 0.0 and 1.0
- **Cascade Delete**: Deleting a user archives their reports (soft delete)
- **Cascade Delete**: Deleting a report removes associated analyses and images